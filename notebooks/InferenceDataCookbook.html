<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Inference Data Cookbook &#8212; ArviZ 0.3.2 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../api.html" />
    <link rel="prev" title="Styles" href="../examples/styles.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/logo.png"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.3.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../examples/index.html">Gallery</a></li>
                <li><a href="Introduction.html">Quickstart</a></li>
                <li><a href="#">Cookbook</a></li>
                <li><a href="XarrayforArviZ.html">InferenceData</a></li>
                <li><a href="../api.html">API</a></li>
                <li><a href="../usage.html">Usage</a></li>
                <li><a href="../about.html">About</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Example Gallery</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Inference-Data-Cookbook">
<h1>Inference Data Cookbook<a class="headerlink" href="#Inference-Data-Cookbook" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">InferenceData</span></code> is the central data format for ArviZ. <code class="docutils literal notranslate"><span class="pre">InferenceData</span></code> itself is just a container that maintains references to one or more <code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code>. Below are various ways to generate an <code class="docutils literal notranslate"><span class="pre">InferenceData</span></code> object. See <a class="reference internal" href="XarrayforArviZ.html"><span class="doc">here</span></a> for more on xarray.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">arviz</span> <span class="kn">as</span> <span class="nn">az</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
<div class="section" id="From-1d-numpy-array">
<h2>From 1d numpy array<a class="headerlink" href="#From-1d-numpy-array" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">size</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">convert_to_inference_data</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">posterior</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Inference data with groups:
        &gt; posterior
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.Dataset&gt;
Dimensions:  (chain: 1, draw: 100)
Coordinates:
  * chain    (chain) int64 0
  * draw     (draw) int64 0 1 2 3 4 5 6 7 8 9 ... 90 91 92 93 94 95 96 97 98 99
Data variables:
    x        (chain, draw) float64 0.293 -0.5543 -0.6883 ... -0.1959 0.02409
Attributes:
    created_at:  2018-12-08T16:18:45.917214
</pre></div>
</div>
</div>
</div>
<div class="section" id="From-nd-numpy-array">
<h2>From nd numpy array<a class="headerlink" href="#From-nd-numpy-array" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">convert_to_inference_data</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">posterior</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Inference data with groups:
        &gt; posterior
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.Dataset&gt;
Dimensions:  (chain: 1, draw: 2, x_dim_0: 3, x_dim_1: 4, x_dim_2: 5)
Coordinates:
  * chain    (chain) int64 0
  * draw     (draw) int64 0 1
  * x_dim_0  (x_dim_0) int64 0 1 2
  * x_dim_1  (x_dim_1) int64 0 1 2 3
  * x_dim_2  (x_dim_2) int64 0 1 2 3 4
Data variables:
    x        (chain, draw, x_dim_0, x_dim_1, x_dim_2) float64 0.007123 ... 0.2306
Attributes:
    created_at:  2018-12-08T16:18:45.933243
</pre></div>
</div>
</div>
</div>
<div class="section" id="From-a-dictionary">
<h2>From a dictionary<a class="headerlink" href="#From-a-dictionary" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">datadict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">convert_to_inference_data</span><span class="p">(</span><span class="n">datadict</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">posterior</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Inference data with groups:
        &gt; posterior
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.Dataset&gt;
Dimensions:  (b_dim_0: 10, c_dim_0: 3, c_dim_1: 4, chain: 1, draw: 100)
Coordinates:
  * chain    (chain) int64 0
  * draw     (draw) int64 0 1 2 3 4 5 6 7 8 9 ... 90 91 92 93 94 95 96 97 98 99
  * b_dim_0  (b_dim_0) int64 0 1 2 3 4 5 6 7 8 9
  * c_dim_0  (c_dim_0) int64 0 1 2
  * c_dim_1  (c_dim_1) int64 0 1 2 3
Data variables:
    a        (chain, draw) float64 -1.483 -1.244 -0.2315 ... -1.501 0.4877
    b        (chain, draw, b_dim_0) float64 2.497 1.039 1.755 ... -2.279 0.3407
    c        (chain, draw, c_dim_0, c_dim_1) float64 -0.4251 0.0699 ... 1.298
Attributes:
    created_at:  2018-12-08T16:18:45.954741
</pre></div>
</div>
</div>
</div>
<div class="section" id="From-dictionary-with-coords-and-dims">
<h2>From dictionary with coords and dims<a class="headerlink" href="#From-dictionary-with-coords-and-dims" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">datadict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c1&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;c2&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="s1">&#39;b1&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)}</span>
<span class="n">dims</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b1&#39;</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;c1&#39;</span><span class="p">,</span> <span class="s1">&#39;c2&#39;</span><span class="p">]}</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">convert_to_inference_data</span><span class="p">(</span><span class="n">datadict</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">posterior</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Inference data with groups:
        &gt; posterior
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;xarray.Dataset&gt;
Dimensions:  (b1: 10, c1: 3, c2: 4, chain: 1, draw: 100)
Coordinates:
  * chain    (chain) int64 0
  * draw     (draw) int64 0 1 2 3 4 5 6 7 8 9 ... 90 91 92 93 94 95 96 97 98 99
  * b1       (b1) int64 0 1 2 3 4 5 6 7 8 9
  * c1       (c1) int64 0 1 2
  * c2       (c2) int64 0 1 2 3
Data variables:
    a        (chain, draw) float64 -2.048 -0.3983 1.1 ... -0.2418 0.3686 -0.1518
    b        (chain, draw, b1) float64 -0.02054 -3.143 ... -0.9643 -0.4444
    c        (chain, draw, c1, c2) float64 2.43 -0.439 ... -0.3713 -0.5101
Attributes:
    created_at:  2018-12-08T16:18:45.992123
</pre></div>
</div>
</div>
</div>
<div class="section" id="From-pymc3">
<h2>From pymc3<a class="headerlink" href="#From-pymc3" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pymc3</span> <span class="kn">as</span> <span class="nn">pm</span>
<span class="n">draws</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">chains</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">eight_school_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;J&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                     <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">28.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">18.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">]),</span>
                     <span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">15.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">16.</span><span class="p">,</span> <span class="mf">11.</span><span class="p">,</span> <span class="mf">9.</span><span class="p">,</span> <span class="mf">11.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">18.</span><span class="p">])</span>
                    <span class="p">}</span>

<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfCauchy</span><span class="p">(</span><span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">theta_tilde</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;theta_tilde&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">eight_school_data</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">tau</span> <span class="o">*</span> <span class="n">theta_tilde</span><span class="p">)</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;obs&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">eight_school_data</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="n">eight_school_data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>

    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">draws</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="n">chains</span><span class="p">)</span>
    <span class="n">prior</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample_prior_predictive</span><span class="p">()</span>
    <span class="n">posterior_predictive</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample_posterior_predictive</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_pymc3</span><span class="p">(</span>
            <span class="n">trace</span><span class="o">=</span><span class="n">trace</span><span class="p">,</span>
            <span class="n">prior</span><span class="o">=</span><span class="n">prior</span><span class="p">,</span>
            <span class="n">posterior_predictive</span><span class="o">=</span><span class="n">posterior_predictive</span><span class="p">,</span>
            <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;school&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">eight_school_data</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])},</span>
            <span class="n">dims</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;theta&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;school&#39;</span><span class="p">],</span> <span class="s1">&#39;theta_tilde&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;school&#39;</span><span class="p">]},</span>
        <span class="p">)</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (2 chains in 4 jobs)
NUTS: [theta_tilde, tau, mu]
Sampling 2 chains: 100%|██████████| 2000/2000 [00:01&lt;00:00, 1407.23draws/s]
There was 1 divergence after tuning. Increase `target_accept` or reparameterize.
100%|██████████| 500/500 [00:00&lt;00:00, 1951.70it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Inference data with groups:
    &gt; posterior
    &gt; sample_stats
    &gt; posterior_predictive
    &gt; prior
    &gt; observed_data
</pre></div>
</div>
</div>
</div>
<div class="section" id="From-pystan">
<h2>From pystan<a class="headerlink" href="#From-pystan" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pystan</span>

<span class="n">schools_code</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        data {</span>
<span class="s1">            int&lt;lower=0&gt; J;</span>
<span class="s1">            real y[J];</span>
<span class="s1">            real&lt;lower=0&gt; sigma[J];</span>
<span class="s1">        }</span>

<span class="s1">        parameters {</span>
<span class="s1">            real mu;</span>
<span class="s1">            real&lt;lower=0&gt; tau;</span>
<span class="s1">            real theta_tilde[J];</span>
<span class="s1">        }</span>

<span class="s1">        transformed parameters {</span>
<span class="s1">            real theta[J];</span>
<span class="s1">            for (j in 1:J)</span>
<span class="s1">                theta[j] = mu + tau * theta_tilde[j];</span>
<span class="s1">        }</span>

<span class="s1">        model {</span>
<span class="s1">            mu ~ normal(0, 5);</span>
<span class="s1">            tau ~ cauchy(0, 5);</span>
<span class="s1">            theta_tilde ~ normal(0, 1);</span>
<span class="s1">            y ~ normal(theta, sigma);</span>
<span class="s1">        }</span>

<span class="s1">        generated quantities {</span>
<span class="s1">            vector[J] log_lik;</span>
<span class="s1">            vector[J] y_hat;</span>
<span class="s1">            for (j in 1:J) {</span>
<span class="s1">                log_lik[j] = normal_lpdf(y[j] | theta[j], sigma[j]);</span>
<span class="s1">                y_hat[j] = normal_rng(theta[j], sigma[j]);</span>
<span class="s1">            }</span>
<span class="s1">        }</span>
<span class="s1">    &#39;&#39;&#39;</span>
<span class="n">stan_model</span> <span class="o">=</span> <span class="n">pystan</span><span class="o">.</span><span class="n">StanModel</span><span class="p">(</span><span class="n">model_code</span><span class="o">=</span><span class="n">schools_code</span><span class="p">)</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">stan_model</span><span class="o">.</span><span class="n">sampling</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">eight_school_data</span><span class="p">,</span>
                          <span class="nb">iter</span><span class="o">=</span><span class="n">draws</span><span class="p">,</span>
                          <span class="n">warmup</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                          <span class="n">chains</span><span class="o">=</span><span class="n">chains</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_pystan</span><span class="p">(</span><span class="n">posterior</span><span class="o">=</span><span class="n">fit</span><span class="p">,</span>
                      <span class="n">posterior_predictive</span><span class="o">=</span><span class="s1">&#39;y_hat&#39;</span><span class="p">,</span>
                      <span class="n">observed_data</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span>
                      <span class="n">log_likelihood</span><span class="o">=</span><span class="s1">&#39;log_lik&#39;</span><span class="p">,</span>
                      <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;school&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">eight_school_data</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])},</span>
                      <span class="n">dims</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;theta&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;school&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;school&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;log_lik&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;school&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;y_hat&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;school&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;theta_tilde&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;school&#39;</span><span class="p">]</span>
                            <span class="p">}</span>
                     <span class="p">)</span>

<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:pystan:COMPILING THE C++ CODE FOR MODEL anon_model_e7aeb8b836685a923269e6171e7377cd NOW.
/home/tbayes/miniconda3/envs/arviz3.6/lib/python3.6/site-packages/Cython/Compiler/Main.py:367: FutureWarning: Cython directive &#39;language_level&#39; not set, using 2 for now (Py2). This will change in a later release! File: /tmp/tmpehtg_iwy/stanfit4anon_model_e7aeb8b836685a923269e6171e7377cd_1721201981547910013.pyx
  tree = Parsing.p_module(s, pxd, full_module_name)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
In file included from /home/tbayes/miniconda3/envs/arviz3.6/lib/python3.6/site-packages/numpy/core/include/numpy/ndarraytypes.h:1821:0,
                 from /home/tbayes/miniconda3/envs/arviz3.6/lib/python3.6/site-packages/numpy/core/include/numpy/ndarrayobject.h:18,
                 from /home/tbayes/miniconda3/envs/arviz3.6/lib/python3.6/site-packages/numpy/core/include/numpy/arrayobject.h:4,
                 from /tmp/tmpehtg_iwy/stanfit4anon_model_e7aeb8b836685a923269e6171e7377cd_1721201981547910013.cpp:688:
/home/tbayes/miniconda3/envs/arviz3.6/lib/python3.6/site-packages/numpy/core/include/numpy/npy_1_7_deprecated_api.h:15:2: warning: #warning &#34;Using deprecated NumPy API, disable it by &#34; &#34;#defining NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION&#34; [-Wcpp]
 #warning &#34;Using deprecated NumPy API, disable it by &#34; \
  ^
In file included from /tmp/tmpehtg_iwy/stanfit4anon_model_e7aeb8b836685a923269e6171e7377cd_1721201981547910013.cpp:692:0:
/home/tbayes/miniconda3/envs/arviz3.6/lib/python3.6/site-packages/pystan/stan_fit.hpp: In function ‘int pystan::{anonymous}::command(pystan::StanArgs&amp;, Model&amp;, pystan::StanHolder&amp;, const std::vector&lt;long unsigned int&gt;&amp;, const std::vector&lt;std::__cxx11::basic_string&lt;char&gt; &gt;&amp;, RNG_t&amp;)’:
/home/tbayes/miniconda3/envs/arviz3.6/lib/python3.6/site-packages/pystan/stan_fit.hpp:830:12: warning: ‘template&lt;class&gt; class std::auto_ptr’ is deprecated [-Wdeprecated-declarations]
       std::auto_ptr&lt;stan::io::var_context&gt; init_context_ptr;
            ^
In file included from /usr/include/c++/5/bits/locale_conv.h:41:0,
                 from /usr/include/c++/5/locale:43,
                 from /usr/include/c++/5/iomanip:43,
                 from /home/tbayes/miniconda3/envs/arviz3.6/lib/python3.6/site-packages/pystan/stan_fit.hpp:5,
                 from /tmp/tmpehtg_iwy/stanfit4anon_model_e7aeb8b836685a923269e6171e7377cd_1721201981547910013.cpp:692:
/usr/include/c++/5/bits/unique_ptr.h:49:28: note: declared here
   template&lt;typename&gt; class auto_ptr;
                            ^
/tmp/tmpehtg_iwy/stanfit4anon_model_e7aeb8b836685a923269e6171e7377cd_1721201981547910013.cpp: In function ‘PyObject* __pyx_pf_71stanfit4anon_model_e7aeb8b836685a923269e6171e7377cd_1721201981547910013_2_call_sampler(PyObject*, PyObject*, PyObject*, PyObject*)’:
/tmp/tmpehtg_iwy/stanfit4anon_model_e7aeb8b836685a923269e6171e7377cd_1721201981547910013.cpp:9242:30: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
     __pyx_t_12 = ((__pyx_t_9 != __pyx_v_fitptr-&gt;param_names_oi().size()) != 0);
                              ^
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING:pystan:Rhat for parameter mu is 1.1939833216977542!
WARNING:pystan:Rhat for parameter tau is 1.1755437966827746!
WARNING:pystan:Rhat for parameter theta[1] is 1.1312100863716745!
WARNING:pystan:Rhat for parameter theta[2] is 1.1005746998099943!
WARNING:pystan:Rhat for parameter log_lik[1] is 1.1646655752781883!
WARNING:pystan:Rhat for parameter log_lik[2] is 1.1564767449269702!
WARNING:pystan:Rhat above 1.1 or below 0.9 indicates that the chains very likely have not mixed
WARNING:pystan:72 of 1000 iterations ended with a divergence (7.2%).
WARNING:pystan:Try running with adapt_delta larger than 0.8 to remove the divergences.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Inference data with groups:
    &gt; posterior
    &gt; sample_stats
    &gt; posterior_predictive
    &gt; observed_data
</pre></div>
</div>
</div>
</div>
<div class="section" id="From-pyro">
<h2>From pyro<a class="headerlink" href="#From-pyro" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">import</span> <span class="nn">pyro</span>
<span class="kn">import</span> <span class="nn">pyro.distributions</span> <span class="kn">as</span> <span class="nn">dist</span>
<span class="kn">import</span> <span class="nn">pyro.poutine</span> <span class="kn">as</span> <span class="nn">poutine</span>
<span class="kn">from</span> <span class="nn">pyro.infer.mcmc</span> <span class="kn">import</span> <span class="n">MCMC</span><span class="p">,</span> <span class="n">NUTS</span>

<span class="n">pyro</span><span class="o">.</span><span class="n">enable_validation</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">pyro</span><span class="o">.</span><span class="n">set_rng_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">draws</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">warmup_steps</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">eight_school_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;J&#39;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                     <span class="s1">&#39;y&#39;</span> <span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">28</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">),</span>
                     <span class="s1">&#39;sigma&#39;</span> <span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">])</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span>
                    <span class="p">}</span>


<span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="n">sigma</span><span class="p">):</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s1">&#39;eta&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">eight_school_data</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">eight_school_data</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])))</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">HalfCauchy</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mi">25</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>

    <span class="n">theta</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">tau</span> <span class="o">*</span> <span class="n">eta</span>

    <span class="k">return</span> <span class="n">pyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">conditioned_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">poutine</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;obs&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">})(</span><span class="n">sigma</span><span class="p">)</span>



<span class="n">nuts_kernel</span> <span class="o">=</span> <span class="n">NUTS</span><span class="p">(</span><span class="n">conditioned_model</span><span class="p">,</span> <span class="n">adapt_step_size</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">posterior</span> <span class="o">=</span> <span class="n">MCMC</span><span class="p">(</span><span class="n">nuts_kernel</span><span class="p">,</span>
                 <span class="n">num_samples</span><span class="o">=</span><span class="n">draws</span><span class="p">,</span>
                 <span class="n">warmup_steps</span><span class="o">=</span><span class="n">warmup_steps</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eight_school_data</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">],</span> <span class="n">eight_school_data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>

<span class="n">pyro_data</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_pyro</span><span class="p">(</span><span class="n">posterior</span><span class="p">)</span>
<span class="n">pyro_data</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:pyro.infer.mcmc.mcmc:Starting MCMC using kernel - NUTS ...
INFO:pyro.infer.mcmc.mcmc:Iteration: 50 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.125390    Acceptance rate: 0.860000
INFO:pyro.infer.mcmc.mcmc:Iteration: 100 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.789698    Acceptance rate: 0.910000
INFO:pyro.infer.mcmc.mcmc:Iteration: 150 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.282786    Acceptance rate: 0.920000
INFO:pyro.infer.mcmc.mcmc:Iteration: 200 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.105557    Acceptance rate: 0.930000
INFO:pyro.infer.mcmc.mcmc:Iteration: 250 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.527265    Acceptance rate: 0.944000
INFO:pyro.infer.mcmc.mcmc:Iteration: 300 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.200404    Acceptance rate: 0.940000
INFO:pyro.infer.mcmc.mcmc:Iteration: 350 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.286618    Acceptance rate: 0.945714
INFO:pyro.infer.mcmc.mcmc:Iteration: 400 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.323607    Acceptance rate: 0.945000
INFO:pyro.infer.mcmc.mcmc:Iteration: 450 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.600277    Acceptance rate: 0.948889
INFO:pyro.infer.mcmc.mcmc:Iteration: 500 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.265936    Acceptance rate: 0.950000
INFO:pyro.infer.mcmc.mcmc:Iteration: 550 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.423345    Acceptance rate: 0.945455
INFO:pyro.infer.mcmc.mcmc:Iteration: 600 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.675079    Acceptance rate: 0.948333
INFO:pyro.infer.mcmc.mcmc:Iteration: 650 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.523993    Acceptance rate: 0.949231
INFO:pyro.infer.mcmc.mcmc:Iteration: 700 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.372428    Acceptance rate: 0.948571
INFO:pyro.infer.mcmc.mcmc:Iteration: 750 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.536313    Acceptance rate: 0.950667
INFO:pyro.infer.mcmc.mcmc:Iteration: 800 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.508929    Acceptance rate: 0.948750
INFO:pyro.infer.mcmc.mcmc:Iteration: 850 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.551862    Acceptance rate: 0.948235
INFO:pyro.infer.mcmc.mcmc:Iteration: 900 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.283344    Acceptance rate: 0.948889
INFO:pyro.infer.mcmc.mcmc:Iteration: 950 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.411292    Acceptance rate: 0.950526
INFO:pyro.infer.mcmc.mcmc:Iteration: 1000 [SAMPLE]
INFO:pyro.infer.mcmc.mcmc:Step size: 0.372683    Acceptance rate: 0.950000
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Inference data with groups:
    &gt; posterior
    &gt; observed_data
</pre></div>
</div>
</div>
</div>
<div class="section" id="From-emcee">
<h2>From emcee<a class="headerlink" href="#From-emcee" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">emcee</span>

<span class="n">eight_school_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;J&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                     <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">28.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">18.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">]),</span>
                     <span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">15.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">16.</span><span class="p">,</span> <span class="mf">11.</span><span class="p">,</span> <span class="mf">9.</span><span class="p">,</span> <span class="mf">11.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">18.</span><span class="p">])</span>
                    <span class="p">}</span>

<span class="k">def</span> <span class="nf">log_prior_8school</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">J</span><span class="p">):</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="c1"># Half-cauchy prior</span>
    <span class="k">if</span> <span class="n">tau</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">hwhm</span> <span class="o">=</span> <span class="mi">25</span>
    <span class="n">prior_tau</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">tau</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">hwhm</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">prior_mu</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">mu</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># normal prior, loc=0, scale=10</span>
    <span class="n">prior_eta</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">eta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># normal prior, loc=0, scale=1</span>
    <span class="k">return</span> <span class="n">prior_mu</span> <span class="o">+</span> <span class="n">prior_tau</span> <span class="o">+</span> <span class="n">prior_eta</span>

<span class="k">def</span> <span class="nf">log_likelihood_8school</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">sigma</span><span class="p">):</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">mu</span> <span class="o">+</span> <span class="n">tau</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">lnprob_8school</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">sigma</span><span class="p">):</span>
    <span class="n">prior</span> <span class="o">=</span> <span class="n">log_prior_8school</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">J</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prior</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">like</span> <span class="o">=</span> <span class="n">log_likelihood_8school</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">like</span><span class="o">+</span><span class="n">prior</span>

<span class="n">nwalkers</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">ndim</span> <span class="o">=</span> <span class="n">eight_school_data</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span>
<span class="n">draws</span> <span class="o">=</span> <span class="mi">1500</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span><span class="n">ndim</span><span class="p">))</span>
<span class="n">pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span>
                                <span class="n">ndim</span><span class="p">,</span>
                                <span class="n">lnprob_8school</span><span class="p">,</span>
                                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">eight_school_data</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">],</span>
                                      <span class="n">eight_school_data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span>
                                      <span class="n">eight_school_data</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span>
                                     <span class="p">)</span>
                               <span class="p">)</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">draws</span><span class="p">)</span>

<span class="c1"># define variable names, it cannot be inferred from emcee</span>
<span class="n">var_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span><span class="s1">&#39;tau&#39;</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;eta{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">eight_school_data</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])]</span>
<span class="n">emcee_data</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_emcee</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="n">var_names</span> <span class="o">=</span> <span class="n">var_names</span><span class="p">)</span>
<span class="n">emcee_data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Inference data with groups:
    &gt; posterior
    &gt; observed_data
</pre></div>
</div>
</div>
</div>
<div class="section" id="From-cmdstan">
<h2>From cmdstan<a class="headerlink" href="#From-cmdstan" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference external" href="https://arviz-devs.github.io/arviz/generated/arviz.from_cmdstan.html#arviz.from_cmdstan">from_cmdstan</a> for details. Cookbook documentation coming soon.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/notebooks/InferenceDataCookbook.ipynb.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2018, ArviZ devs.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>